---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout title="パスワードリセット">
<div class="max-w-md mx-auto my-20 p-8 bg-gray-800 rounded-lg shadow-xl border border-gray-700">

    <h1 class="text-3xl font-bold text-center text-white mb-2">パスワードをリセット</h1>
    
    <p class="text-center text-gray-400 mb-8" style="margin-top:0.5em;">
        ご登録のメールアドレスを入力してください。パスワード再設定用のリンクを送信します。
    </p>

    <form id="reset-request-form" class="space-y-6">
        
        <div>
            <label for="email" class="form-label">メールアドレス</label>
            <input 
                id="email" 
                name="email" 
                type="email" 
                required 
                class="form-input" 
                placeholder="your-email@example.com"
            >
        </div>
        
        <div>
            <button type="submit" class="btn btn-primary w-full">
                <span>リセット用リンクを送信</span>
            </button>
        </div>
        
        <p 
            id="feedback-message" 
            class="text-center text-sm pt-2 transition-opacity duration-300 opacity-0"
            ></p>
        
    </form>
</div>

<div class="text-center mt-2">
    <p class="text-xs text-gray-500">
        購入時のメールアドレスが不明な場合は、ご購入の際の控えメールを添えて、<br>「購入時メールアドレスがわかりません」という件名で、下記までご連絡ください。<br>
        <a href="mailto:info@ai-verve.net" class="text-blue-400 hover:underline">info@ai-verve.net</a>
    </p>
</div>

<script is:inline>
    const form = document.getElementById('reset-request-form');
    const messageEl = document.getElementById('feedback-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;

        try {
            const response = await fetch('/snspack/wp-json/a1-project/v1/request-password-reset', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            });

            const data = await response.json();

            // 成功・失敗に関わらず、ユーザーには同じメッセージを表示し、安心感を与える
            messageEl.textContent = 'ご入力いただいたメールアドレス宛に、パスワード再設定のご案内を送信しました。（アカウントが存在しない場合、メールは送信されません）';
            messageEl.style.color = 'white';

        } catch (error) {
            messageEl.textContent = 'エラーが発生しました。時間をおいて再度お試しください。';
            messageEl.style.color = 'white';
        }
    });
</script>
</BaseLayout>