---
import BaseLayout from '../layouts/BaseLayout.astro';
---
<BaseLayout title="パスワードリセット">
    <form id="reset-request-form">
    <label for="email">メールアドレス</label>
    <input id="email" name="email" type="email" required>
    <button type="submit">パスワードリセット用のリンクを送信</button>
    <p id="feedback-message"></p>
</form>

<script is:inline>
    const form = document.getElementById('reset-request-form');
    const messageEl = document.getElementById('feedback-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;

        try {
            const response = await fetch('/snspack/wp-json/a1-project/v1/request-password-reset', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            });

            const data = await response.json();

            // 成功・失敗に関わらず、ユーザーには同じメッセージを表示し、安心感を与える
            messageEl.textContent = 'ご入力いただいたメールアドレス宛に、パスワード再設定のご案内を送信しました。（アカウントが存在しない場合、メールは送信されません）';
            messageEl.style.color = 'green';

        } catch (error) {
            messageEl.textContent = 'エラーが発生しました。時間をおいて再度お試しください。';
            messageEl.style.color = 'red';
        }
    });
</script>
</BaseLayout>